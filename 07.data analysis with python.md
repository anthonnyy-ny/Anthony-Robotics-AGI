


您問的 **`loc`** 函數（或更準確地說，是 Pandas DataFrame 的一個**屬性/方法**）是 Python 數據分析中最核心、最常用的工具之一。

它來自 **Pandas 庫**，專門用於對數據進行**基於標籤 (Label-based)** 的資料選取和切片。

---

## 🔍 Pandas `.loc` 的作用

`loc` 的全名是 **Location (位置)**，它是用來根據 **行索引的名稱** 和 **列的名稱** 來選擇數據的。

### 1. 核心語法

`loc` 始終遵循以下結構，使用方括號 `[]` 進行操作：

$$df.loc[行選擇條件, 列選擇條件]$$

|**參數**|**說明**|
|---|---|
|**行選擇條件**|可以是單個行標籤名、標籤列表、標籤切片，或是一個布林條件。|
|**列選擇條件**|可以是單個列名、列名列表，或是一個列名切片。|

### 2. `.loc` 的關鍵特性（與其他方法的區別）

- **基於標籤 (Label-based)：** 這是 `.loc` 與 `.iloc`（基於整數位置）最主要的區別。
    
- **切片包含終點：** 當您使用標籤進行切片時，**結束的標籤也是包含在內的**。
    
    - _例如：_ `df.loc['a':'c']` 會包含名為 'a', 'b', **'c'** 的行。
        

### 3. 實用範例

假設您有一個 DataFrame 叫 `df_students`，其行索引是學號，列名是成績：

|**學號 (Index)**|**國文 (Chinese)**|**數學 (Math)**|**英文 (English)**|
|---|---|---|---|
|**S001**|90|85|95|
|**S002**|78|92|88|
|**S003**|65|70|75|

|**選擇操作**|**作用**|**結果**|
|---|---|---|
|`df.loc['S001']`|選擇單個行標籤為 'S001' 的學生。|S001 學生所有科目的成績。|
|`df.loc[:, '數學']`|選擇所有行，但只選擇名為 '數學' 的列。|所有學生的數學成績。|
|`df.loc['S001':'S002', '國文':'數學']`|**基於標籤切片**，選擇 S001 到 S002 的學生，以及國文到數學的成績。|包含 S001 和 S002 的國文和數學成績。|

### 4. 最強大的用法：布林遮罩 (Boolean Mask)

`.loc` 經常與條件判斷結合使用，這是數據清洗和篩選的核心：

Python

```
# 範例：選出數學成績大於 80 分的學生，並查看他們的英文成績
high_math_scores = df_students['數學'] > 80

# df_students.loc[布林條件, 選擇列]
result = df_students.loc[high_math_scores, ['國文', '英文']]

print(result)
# 將只顯示 S001 和 S002 的國文和英文成績
```

loc 是 Pandas 中用于 基于标签 (Label-based) 访问和选择数据的属性。

简单来说，就是通过 行和列的名字（索引） 来定位数据，而不是通过它们的位置（第几行第几列）。

核心用法
语法通常是：df.loc[行标签, 列标签]

假设你有这样一个简单的销售数据（基于你之前的 Bike Store 例子）：

python
import pandas as pd

data = {
    'Country': ['Canada', 'Australia', 'USA', 'France'],
    'Revenue': [950, 2401, 1200, 800]
}
# 假设我们将 'Order_ID' 作为索引（标签）
df = pd.DataFrame(data, index=['Ord_001', 'Ord_002', 'Ord_003', 'Ord_004'])
Country	Revenue
Ord_001	Canada	950
Ord_002	Australia	2401
Ord_003	USA	1200
Ord_004	France	800
常见场景
1. 选取某一行 (通过索引名)

python
# 获取索引为 'Ord_002' 的那一行数据
df.loc['Ord_002']
# 结果: Country: Australia, Revenue: 2401
2. 选取具体的某个值 (行名 + 列名)

python
# 获取 'Ord_001' 这一行的 'Country' 列
df.loc['Ord_001', 'Country']
# 结果: 'Canada'
3. 切片 (注意：包含结束标签!) 这是 loc 和普通 Python 切片最大的不同，它包含最后一个标签。

python
# 获取从 'Ord_001' 到 'Ord_003' 的行
df.loc['Ord_001':'Ord_003']
# 结果: 会包含 Ord_001, Ord_002, 和 Ord_003 三行
4. 条件筛选 (布尔索引) —— 非常常用 这是 loc 最强大的地方，可以根据条件筛选行。

python
# 筛选出 Revenue 大于 1000 的所有行，并只看 'Country' 列
df.loc[df['Revenue'] > 1000, 'Country']
# 结果:
# Ord_002    Australia
# Ord_003    USA
总结：loc vs iloc
loc: 看 名字 (标签)。例如 loc['Ord_001']。切片包含末尾。
iloc: 看 位置 (整数下标)。例如 iloc[0] (第一行)。切片不包含末尾。